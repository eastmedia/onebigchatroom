<% broadcast '/messages/new' do %>

  $('#messages').append("<%= escape_javascript render(@message)%>");

  <% if ProfanityFilter::Base.profane?(@message.body) %>
    var dirty_word_continer = $("#<%= dom_id(@message, 'shakable_content') %>");
    dirty_word_continer.jrumble();
    dirty_word_continer.trigger('startRumble');
  <% end %>

  <% ["stephen", "ross", "eastmedia"].each do |dudes_name| %>
    <% if @message.body.downcase.include?(dudes_name) %>
      person_appears("<%= dudes_name %>");
      <% break %>
    <% end %>
    window.scrollTo(0, $("#messages").height());

    play_new();

<% end %>
<% end %>

$('form')[0].reset()
$("#message_body").focus();
